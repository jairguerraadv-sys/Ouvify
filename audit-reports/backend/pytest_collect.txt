============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.2, pluggy-1.6.0
django: version: 5.1.15, settings: config.settings (from env)
rootdir: /workspaces/Ouvify
configfile: pytest.ini
plugins: cov-7.0.0, django-4.11.1, anyio-4.12.1, locust-2.43.2, env-1.2.0
collected 374 items

<Dir Ouvify>
  <Dir apps>
    <Dir backend>
      <Package apps>
        <Package auditlog>
          <Package tests>
            <Module test_auditlog.py>
              <Class TestAuditLogModel>
                <Function test_create_log_with_manager>
                <Function test_create_log_with_metadata>
                <Function test_create_log_with_ip_and_user_agent>
                <Function test_create_log_with_severity>
                <Function test_log_timestamp_auto>
              <Class TestAuditLogQueries>
                <Function test_filter_by_action>
                <Function test_recent_logs>
              <Class TestAuditLogActions>
                <Function test_login_action>
                <Function test_logout_action>
                <Function test_create_action>
                <Function test_update_action>
                <Function test_delete_action>
                <Function test_password_change_action>
                <Function test_login_failed_action>
              <Class TestAuditLogWithoutTenant>
                <Function test_create_log_without_tenant>
                <Function test_create_log_without_user>
        <Package billing>
          <Package tests>
            <Module test_billing.py>
              <Class TestPlanModel>
                <Function test_plan_price_display>
                <Function test_plan_is_free>
                <Function test_plan_has_feature>
                <Function test_plan_get_limit>
                <Function test_plan_str>
                <Function test_plan_creation>
                <Function test_plan_active_filter>
              <Class TestSubscriptionLifecycle>
                <Function test_subscription_status_active>
                <Function test_subscription_trial_start>
                <Function test_subscription_cancel>
                <Function test_subscription_activate>
                <Function test_subscription_can_access_features>
                <Function test_subscription_past_due_grace_period>
                <Function test_subscription_unique_per_tenant>
                <Function test_subscription_expired>
              <Class TestInvoiceModel>
                <Function test_invoice_creation>
                <Function test_invoice_pending>
                <Function test_invoice_amount_display>
              <Class TestCheckoutLogic>
                <Function test_checkout_session_creation_mock>
              <Class TestWebhookLogic>
                <Function test_checkout_completed_event_structure>
                <Function test_subscription_updated_event_structure>
                <Function test_invoice_paid_event_structure>
              <Class TestStripeServiceMocked>
                <Function test_create_customer_mock>
                <Function test_cancel_subscription_mock>
                <Function test_billing_portal_session_mock>
        <Package consent>
          <Package tests>
            <Module test_consent.py>
              <Class TestConsentVersionModel>
                <Function test_create_consent_version>
                <Function test_only_one_current_version_per_type>
                <Function test_consent_version_str>
              <Class TestUserConsentModel>
                <Function test_create_user_consent>
                <Function test_accept_consent>
                <Function test_revoke_consent>
                <Function test_anonymous_consent>
              <Class TestConsentAuditTrail>
                <Function test_consent_records_ip_address>
                <Function test_consent_records_user_agent>
                <Function test_consent_records_context>
                <Function test_consent_timestamps>
              <Class TestConsentVersionManagement>
                <Function test_multiple_document_types>
                <Function test_version_history>
                <Function test_required_vs_optional_consent>
              <Class TestUserConsentQueries>
                <Function test_filter_by_user>
                <Function test_filter_accepted_consents>
                <Function test_filter_revoked_consents>
        <Package core>
          <Package tests>
            <Module test_core_utils.py>
              <Class TestSanitizers>
                <Class TestHTMLSanitizer>
                  <Function test_sanitize_html_basic>
                  <Function test_sanitize_html_escapes_tags>
                  <Function test_sanitize_empty_string>
                  <Function test_sanitize_max_length>
                  <Function test_sanitize_removes_null_bytes>
                  <Function test_sanitize_javascript_protocol>
                <Class TestFilenameSanitizer>
                  <Function test_sanitize_filename_basic>
                  <Function test_sanitize_filename_removes_special_chars>
                  <Function test_sanitize_filename_preserves_extension>
                <Class TestPhoneSanitizer>
                  <Function test_sanitize_phone_removes_formatting>
                  <Function test_sanitize_phone_keeps_numbers>
                <Class TestEmailSanitizer>
                  <Function test_sanitize_email_lowercase>
                  <Function test_sanitize_email_removes_spaces>
              <Class TestValidators>
                <Class TestCNPJValidator>
                  <Function test_valid_cnpj>
                  <Function test_invalid_cnpj_format>
                  <Function test_invalid_cnpj_repeated_digits>
                <Class TestPhoneValidator>
                  <Function test_valid_mobile_phone>
                  <Function test_valid_landline>
                  <Function test_invalid_phone_short>
                <Class TestSubdomainValidator>
                  <Function test_valid_subdomain>
                  <Function test_invalid_subdomain_short>
                  <Function test_invalid_subdomain_reserved>
                <Class TestHexColorValidator>
                  <Function test_valid_hex_color>
                  <Function test_invalid_hex_color>
                <Class TestProtocolCodeValidator>
                  <Function test_valid_protocol_code>
                  <Function test_invalid_protocol_code>
              <Class TestPagination>
                <Function test_pagination_default_page_size>
                <Function test_pagination_max_page_size>
              <Class TestMiddleware>
                <Function test_security_headers_middleware_exists>
              <Class TestHealthCheck>
                <Function test_health_endpoint>
                <Function test_health_returns_json>
            <Module test_ip_utils.py>
              <UnitTestCase IPAnonymizationTests>
                <TestCaseFunction test_anonymize_ip_auto_detection>
                <TestCaseFunction test_anonymize_ip_preserves_geography>
                <TestCaseFunction test_anonymize_ipv4_invalid>
                <TestCaseFunction test_anonymize_ipv4_standard>
                <TestCaseFunction test_anonymize_ipv6_invalid>
                <TestCaseFunction test_anonymize_ipv6_standard>
              <UnitTestCase ClientIPExtractionTests>
                <TestCaseFunction test_get_client_ip_direct>
                <TestCaseFunction test_get_client_ip_fallback>
                <TestCaseFunction test_get_client_ip_priority>
                <TestCaseFunction test_get_client_ip_x_forwarded_for>
                <TestCaseFunction test_get_client_ip_x_real_ip>
            <Module test_lgpd.py>
              <Class TestConsentManagement>
                <Function test_create_consent_version>
                <Function test_user_accept_consent>
                <Function test_consent_audit_trail>
                <Function test_consent_version_history>
                <Function test_required_consent_filter>
                <Function test_user_has_accepted_consent>
              <Class TestDataExport>
                <Function test_export_user_basic_data>
                <Function test_export_consent_history>
                <Function test_export_data_structure_json>
              <Class TestAccountDeletion>
                <Function test_soft_delete_user>
                <Function test_anonymize_user_data>
                <Function test_cascade_delete_consent_history>
                <Function test_delete_preserves_audit_summary>
              <Class TestDataMinimization>
                <Function test_user_required_fields_only>
                <Function test_consent_stores_minimal_data>
                <Function test_no_unnecessary_personal_data>
              <Class TestLGPDCompliance>
                <Function test_consent_before_data_processing>
                <Function test_right_to_be_informed>
                <Function test_consent_withdrawal>
                <Function test_data_retention_awareness>
        <Package feedbacks>
          <Package tests>
            <Module test_export_import.py>
              <UnitTestCase ExportServiceTest>
                <TestCaseFunction test_export_csv>
                <TestCaseFunction test_export_invalid_format>
                <TestCaseFunction test_export_json>
                <TestCaseFunction test_export_with_filters>
              <UnitTestCase ImportServiceTest>
                <TestCaseFunction test_import_csv>
                <TestCaseFunction test_import_invalid_json>
                <TestCaseFunction test_import_json>
                <TestCaseFunction test_import_skip_existing>
                <TestCaseFunction test_import_update_existing>
                <TestCaseFunction test_normalize_prioridade>
                <TestCaseFunction test_normalize_status>
                <TestCaseFunction test_normalize_tipo>
            <Module test_performance.py>
              <UnitTestCase FeedbackQueryOptimizationTest>
                <TestCaseFunction test_individual_queries_optimized>
                <TestCaseFunction test_no_n_plus_1_in_detail_view>
                <TestCaseFunction test_no_n_plus_1_in_list_view>
            <Module test_views.py>
              <Class TestFeedbackViewSet>
                <Function test_create_feedback_authenticated>
                <Function test_create_feedback_with_missing_fields>
                <Function test_create_feedback_sanitizes_html>
                <Function test_list_feedbacks_authenticated>
                <Function test_list_feedbacks_isolation>
                <Function test_retrieve_feedback_detail>
                <Function test_retrieve_feedback_from_other_tenant_fails>
                <Function test_update_feedback_status>
                <Function test_update_feedback_by_other_tenant_fails>
                <Function test_delete_feedback>
                <Function test_protocolo_format>
                <Function test_consulta_protocolo_publico>
                <Function test_consulta_protocolo_invalido>
                <Function test_add_interacao_to_feedback>
              <Class TestFeedbackFilters>
                <Function test_filter_by_tipo>
                <Function test_filter_by_status>
                <Function test_search_by_titulo>
              <Class TestFeedbackPermissions>
                <Function test_unauthenticated_cannot_list>
                <Function test_unauthenticated_can_create_anonymous>
        <Package notifications>
          <Package tests>
            <Module test_notifications.py>
              <Class TestPushSubscriptionModel>
                <Function test_create_subscription>
                <Function test_subscription_unique_per_user_endpoint>
                <Function test_deactivate_subscription>
                <Function test_mark_as_used>
                <Function test_subscription_str>
              <Class TestNotificationModel>
                <Function test_create_notification>
                <Function test_mark_notification_as_read>
                <Function test_notification_data_field>
                <Function test_notification_ordering>
              <Class TestNotificationQueries>
                <Function test_filter_unread_notifications>
                <Function test_filter_by_type>
                <Function test_filter_by_tenant>
              <Class TestPushSubscriptionQueries>
                <Function test_filter_active_subscriptions>
                <Function test_filter_by_user>
        <Package tenants>
          <Package tests>
            <Module test_auth_flows.py>
              <Class TestUserRegistration>
                <Function test_register_tenant_with_valid_data>
                <Function test_register_with_weak_password>
                <Function test_register_with_duplicate_email>
                <Function test_register_with_duplicate_subdomain>
              <Class TestJWTAuthentication>
                <Function test_obtain_token_pair>
                <Function test_obtain_token_with_invalid_credentials>
                <Function test_refresh_token>
                <Function test_access_protected_endpoint_with_valid_token>
                <Function test_access_protected_endpoint_without_token>
                <Function test_access_with_expired_token>
              <Class TestLogout>
                <Function test_logout_blacklists_token>
              <Class TestPasswordValidation>
                <Function test_password_min_length>
                <Function test_password_requires_uppercase>
                <Function test_password_requires_number>
              <Class TestTenantIsolationAuth>
                <Function test_user_cannot_login_to_other_tenant>
                <Function test_token_only_valid_for_own_tenant>
            <Module test_jwt_auth.py>
              <UnitTestCase JWTAuthTestCase>
                <TestCaseFunction test_authenticated_request_with_jwt>
                <TestCaseFunction test_expired_token_rejected>
                <TestCaseFunction test_invalid_credentials>
                <TestCaseFunction test_obtain_token_pair>
                <TestCaseFunction test_tenant_mismatch_blocked_with_jwt>
                <TestCaseFunction test_token_auth_header_rejected>
                <TestCaseFunction test_token_refresh>
                <TestCaseFunction test_token_verify>
            <Module test_team_invitation_and_branding_security.py>
              <Class TestTeamInvitationAcceptSecurity>
                <Function test_accept_invitation_existing_user_requires_correct_password>
              <Class TestBrandingAuthorization>
                <Function test_viewer_cannot_patch_tenant_info_branding>
                <Function test_owner_can_patch_tenant_info_branding>
            <Module test_tenant_views.py>
              <Class TestTenantViewSet>
                <Function test_create_tenant_as_superadmin>
                <Function test_create_tenant_with_duplicate_subdomain>
                <Function test_create_tenant_with_reserved_subdomain>
                <Function test_subdomain_format_validation>
                <Function test_list_tenants_as_superadmin>
                <Function test_owner_sees_only_own_tenant>
                <Function test_update_tenant_branding>
                <Function test_update_tenant_name>
                <Function test_cannot_update_other_tenant>
                <Function test_upgrade_plan>
                <Function test_downgrade_plan>
                <Function test_plan_limits>
                <Function test_deactivate_tenant>
                <Function test_reactivate_tenant>
                <Function test_delete_tenant_as_superadmin>
                <Function test_owner_cannot_delete_tenant>
              <Class TestTenantModel>
                <Function test_str_representation>
                <Function test_default_plan>
                <Function test_default_active_status>
              <Class TestTenantServices>
                <Function test_tenant_has_plan_limits>
                <Function test_subdomain_uniqueness>
            <Module test_upload.py>
              <Class TestImageValidation>
                <Function test_validate_valid_png>
                <Function test_validate_valid_jpeg>
                <Function test_validate_valid_webp>
                <Function test_reject_svg_format>
                <Function test_reject_invalid_extension>
              <Class TestUploadSizeLimit>
                <Function test_reject_oversized_logo>
                <Function test_reject_oversized_favicon>
                <Function test_accept_valid_size>
                <Function test_reject_too_small_file>
              <Class TestMimeTypeValidation>
                <Function test_validate_correct_mime_type>
                <Function test_reject_mismatched_extension>
                <Function test_reject_disallowed_mime_type>
                <Function test_skip_validation_when_magic_unavailable>
              <Class TestUploadLogo>
                <Function test_upload_logo_success>
                <Function test_upload_logo_rejects_svg>
              <Class TestUploadFavicon>
                <Function test_upload_favicon_success>
                <Function test_upload_favicon_rejects_non_square>
              <Class TestUploadSecurity>
                <Function test_reject_double_extension>
                <Function test_reject_php_disguised_as_image>
                <Function test_allowed_formats_list>
                <Function test_mime_types_mapping>
              <Class TestUploadConfiguration>
                <Function test_max_logo_size>
                <Function test_max_favicon_size>
                <Function test_logo_dimensions>
                <Function test_favicon_dimensions>
      <Module test_sanitization.py>
        <Function test_sanitize_html_input>
        <Function test_sanitize_rich_text>
        <Function test_sanitize_plain_text>
        <Function test_edge_cases>
      <Module test_security_fixes.py>
        <Function test_protocolo_generation>
        <Function test_tenant_isolation_in_views>
        <Function test_database_indices>
      <Package tests>
        <Module test_analytics.py>
          <Class TestAnalyticsEndpoint>
            <Function test_analytics_sem_tenant_retorna_erro>
          <Class TestAnalyticsCalculations>
            <Function test_resumo_por_status>
            <Function test_metricas_sla>
            <Function test_agregacao_por_tipo>
            <Function test_agregacao_por_prioridade>
          <Class TestExportCSV>
            <Function test_export_sem_tenant_retorna_erro>
          <Class TestDashboardStatsCache>
            <Function test_dashboard_stats_cacheavel>
            <Function test_analytics_cache_diferente_por_periodo>
          <Class TestTendencias>
            <Function test_tendencia_por_dia>
        <Module test_analytics_dashboard_api.py>
          <Function test_analytics_dashboard_shape>
        <Module test_api_keys.py>
          <Class TestAPIKeyGeneration>
            <Function test_generate_api_key>
            <Function test_generate_api_key_with_expiration>
            <Function test_generate_api_key_with_custom_rate_limit>
          <Class TestAPIKeyValidation>
            <Function test_validate_valid_key>
            <Function test_validate_invalid_key>
            <Function test_validate_expired_key>
            <Function test_validate_revoked_key>
            <Function test_validate_updates_usage>
          <Class TestAPIKeyRateLimiting>
            <Function test_rate_limit_not_exceeded>
            <Function test_rate_limit_exceeded>
          <Class TestAPIKeyPermissions>
            <Function test_read_permission>
            <Function test_write_permission>
            <Function test_admin_permission>
          <Class TestAPIKeyRevocation>
            <Function test_revoke_key>
            <Function test_revoked_key_string_representation>
        <Module test_api_tenant_isolation.py>
          <UnitTestCase TestAPIClientIsolation>
            <TestCaseFunction test_consultar_protocolo_publico_funciona>
            <TestCaseFunction test_list_feedbacks_requer_autenticacao>
            <TestCaseFunction test_responder_protocolo_publico>
        <Module test_automations.py>
          <Class TestAutoAssignment>
            <Function test_feedback_ja_atribuido_ignora>
            <Function test_round_robin_balanceamento>
          <Class TestSLAEscalation>
            <Function test_identifica_sla_vencido>
            <Function test_identifica_critico_sem_resposta>
            <Function test_check_sla_escalation_executa>
          <Class TestDailyDigest>
            <Function test_generate_tenant_digest>
          <Class TestAssignmentRules>
            <Function test_apply_rules_por_tipo>
            <Function test_apply_rules_por_prioridade>
        <Module test_email_templates.py>
          <Class TestEmailTemplates>
            <Function test_welcome_email_content>
            <Function test_email_confirmation_content>
            <Function test_password_reset_content>
            <Function test_feedback_notification_content>
            <Function test_weekly_report_content>
            <Function test_team_invitation_content>
            <Function test_all_templates_have_unsubscribe>
            <Function test_all_templates_are_responsive>
            <Function test_html_injection_prevented>
        <Module test_feature_gating.py>
          <UnitTestCase PlanFeaturesTestCase>
            <TestCaseFunction test_get_plan_features>
            <TestCaseFunction test_get_plan_features_invalid_plan>
            <TestCaseFunction test_get_upgrade_message>
            <TestCaseFunction test_has_feature>
            <TestCaseFunction test_plan_feature_structure>
            <TestCaseFunction test_plan_features_exist>
            <TestCaseFunction test_storage_limits>
            <TestCaseFunction test_support_tiers>
          <UnitTestCase ClientPlanMethodsTestCase>
            <TestCaseFunction test_get_max_feedbacks_per_month>
            <TestCaseFunction test_get_storage_limit_gb>
            <TestCaseFunction test_get_support_tier>
            <TestCaseFunction test_get_upgrade_message>
            <TestCaseFunction test_has_feature_api_access>
            <TestCaseFunction test_has_feature_attachments>
            <TestCaseFunction test_has_feature_custom_branding>
            <TestCaseFunction test_has_feature_internal_notes>
            <TestCaseFunction test_has_feature_webhooks>
            <TestCaseFunction test_is_premium_active_subscription>
            <TestCaseFunction test_is_premium_free_plan>
          <UnitTestCase FeatureNotAvailableErrorTestCase>
            <TestCaseFunction test_exception_creation>
            <TestCaseFunction test_exception_custom_message>
          <UnitTestCase FeedbackViewSetFeatureGatingTestCase>
            <TestCaseFunction test_free_plan_cannot_create_internal_notes>
            <TestCaseFunction test_public_responses_not_blocked_by_feature_gating>
            <TestCaseFunction test_starter_plan_can_create_internal_notes>
          <UnitTestCase FeatureGatingExceptionHandlerTestCase>
            <TestCaseFunction test_feature_not_available_returns_403>
        <Module test_feedback_assignment.py>
          <Class TestFeedbackAssignment>
            <Function test_assign_feedback_to_team_member>
            <Function test_filter_assigned_to_me>
            <Function test_unassign_feedback>
            <Function test_filter_unassigned_feedbacks>
            <Function test_multiple_assignments_to_same_member>
        <Module test_integration.py>
          <UnitTestCase FeedbackAPITestCase>
            <TestCaseFunction test_consultar_protocolo>
            <TestCaseFunction test_create_feedback_anonymous>
            <TestCaseFunction test_create_feedback_authenticated>
            <TestCaseFunction test_protocolo_not_found>
            <TestCaseFunction test_rate_limiting>
            <TestCaseFunction test_tenant_isolation>
          <UnitTestCase HealthCheckTestCase>
            <TestCaseFunction test_api_health_endpoint>
            <TestCaseFunction test_health_endpoint>
        <Module test_prioridade.py>
          <Class TestPrioridadeSystem>
            <Function test_create_feedback_with_default_prioridade>
            <Function test_create_feedback_with_alta_prioridade>
            <Function test_create_feedback_with_critica_prioridade>
            <Function test_filter_by_prioridade>
            <Function test_prioridade_choices>
        <Module test_security_consultar_protocolo.py>
          <UnitTestCase ConsultarProtocoloSecurityTests>
            <TestCaseFunction test_consultar_protocolo_case_insensitive>
            <TestCaseFunction test_consultar_protocolo_nao_expoe_campos_sensÃ­veis>
            <TestCaseFunction test_consultar_protocolo_outro_tenant_retorna_404>
            <TestCaseFunction test_consultar_protocolo_sem_parametro_retorna_400>
            <TestCaseFunction test_consultar_protocolo_sem_tenant_header_retorna_400>
            <TestCaseFunction test_consultar_protocolo_tenant_correto_retorna_200_com_dados_publicos>
            <TestCaseFunction test_consultar_protocolo_tenant_inativo_retorna_404>
            <TestCaseFunction test_consultar_protocolo_tenant_invalido_retorna_404>
            <TestCaseFunction test_consultar_protocolo_via_subdominio_funcionando>
          <UnitTestCase ConsultarProtocoloEnumerationTests>
            <TestCaseFunction test_enumeracao_protocolos_retorna_404_generico>
            <TestCaseFunction test_nao_consegue_enumerar_protocols_cross_tenant>
          <UnitTestCase ConsultarProtocoloRateLimitingTests>
            <TestCaseFunction test_consultar_protocolo_rate_limiting_placeholder>
        <Module test_sla.py>
          <Class TestSLAFieldsExist>
            <Function test_campos_sla_existem>
            <Function test_campos_sla_inicialmente_nulos>
          <Class TestSLAPrimeiraResposta>
            <Function test_registrar_primeira_resposta>
            <Function test_sla_dentro_do_prazo>
            <Function test_sla_fora_do_prazo>
            <Function test_sla_customizado>
          <Class TestSLAResolucao>
            <Function test_registrar_resolucao>
            <Function test_sla_resolucao_dentro_prazo>
            <Function test_sla_resolucao_fora_prazo>
          <Class TestSLAIntegracao>
            <Function test_fluxo_completo_sla>
            <Function test_sla_preservado_apos_salvar>
          <Class TestSLASerializacao>
            <Function test_campos_sla_no_serializer>
            <Function test_campos_sla_somente_leitura>
        <Module test_tags.py>
          <Class TestTagSystem>
            <Function test_create_tag>
            <Function test_tag_feedback_count>
            <Function test_feedback_with_multiple_tags>
        <Module test_team_management.py>
          <Class TestTeamMember>
            <Function test_create_team_member>
            <Function test_owner_has_all_permissions>
            <Function test_viewer_has_limited_permissions>
          <Class TestTeamInvitation>
            <Function test_create_invitation_with_token>
            <Function test_accept_invitation_creates_team_member>
          <Class TestClientTeamLimits>
            <Function test_free_plan_limit>
            <Function test_starter_plan_limit>
            <Function test_pro_plan_limit>
        <Module test_tenant_isolation.py>
          <UnitTestCase TestTenantIsolation>
            <TestCaseFunction test_feedback_isolation_between_tenants>
            <TestCaseFunction test_query_filtering_by_tenant>

========================= 374 tests collected in 0.55s =========================
